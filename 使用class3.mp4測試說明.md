# 使用 class3.mp4 測試 F5-TTS 🎬

## ✅ 您已準備好！

您已經在目錄中放置了 `class3.mp4`，測試腳本會**自動檢測並使用它**作為參考音頻！

---

## 🚀 立即測試

### 快速測試

```bash
cd /Users/raychang/Documents/專案/Deep-Video-TranslationDocker
source .venv/bin/activate
python test_f5tts_standalone.py --quick
```

### 完整測試

```bash
python test_f5tts_standalone.py
```

### 自定義文字測試

```bash
python test_f5tts_standalone.py --text "您想要合成的任何文字"
```

---

## 📝 提升質量的重要提示

### 1. 提供參考文字（推薦！）

為了獲得**最佳語音克隆效果**，建議您提供 `class3.mp4` 前 10 秒的實際文字內容。

#### 步驟：

**A. 手動轉錄（最準確）**

1. 播放 class3.mp4 前 10 秒
2. 聽寫並記錄說話的內容
3. 修改測試腳本中的 `ref_text`

**B. 使用 ASR 自動轉錄（方便）**

```python
# 創建一個快速腳本來獲取參考文字
from modules.asr_llm import ASRProcessor

asr = ASRProcessor()
segments = asr.transcribe("class3.mp4")

# 取前 10 秒的文字
ref_text = " ".join([seg["text"] for seg in segments if seg["end"] <= 10])
print(f"參考文字: {ref_text}")
```

**C. 修改測試腳本**

編輯 `test_f5tts_standalone.py` 第 25 行：

```python
"中文測試": {
    "ref_text": "這裡改成 class3.mp4 前 10 秒的實際內容",  # ⬅️ 改這裡
    "gen_text": "大家好，我是 F5-TTS 語音合成系統...",
    "description": "中文語音合成測試"
},
```

---

## 🎯 測試流程

```
1. 腳本自動檢測 class3.mp4 ✅
   ↓
2. 從視頻提取前 10 秒音頻
   ↓
3. 轉換為 24kHz WAV 格式
   ↓
4. 使用此音頻進行語音克隆
   ↓
5. 生成測試語音 🎤
```

---

## 📊 預期輸出

### 運行測試時會看到：

```
================================================================================
F5-TTS 獨立功能測試
================================================================================

📋 測試配置:
  - 設備: mps
  - 測試目錄: /path/to/temp
  - 測試案例數: 4
  - 參考音頻: 從 class3.mp4 提取 ✨
  - 💡 提示: 使用真實視頻音頻，語音克隆效果會更好！

================================================================================
步驟 1/4: 準備參考音頻
================================================================================
✅ 發現用戶提供的視頻: class3.mp4
從視頻提取音頻: /path/to/class3.mp4
✅ 音頻提取成功（10.0 秒）
✅ 參考音頻準備完成
   文件: test_ref_audio.wav
   大小: 480.5 KB
   時長: 10.0 秒

================================================================================
步驟 2/4: 載入 F5-TTS 模型
================================================================================
✅ TTSProcessor 初始化成功
   註: 首次運行會下載模型（~500MB），請耐心等待...

================================================================================
步驟 3/4: 運行測試案例
================================================================================

🧪 測試: 中文測試
   描述: 中文語音合成測試
   參考文字: 這是一段參考音頻的文字，用來克隆聲音。...
   生成文字: 大家好，我是 F5-TTS 語音合成系統。今天天氣很好...
   ✅ 成功！輸出: test_output_中文測試.wav (125.3 KB)

...
```

---

## 🎧 播放生成的音頻

```bash
# macOS
afplay temp/test_output_中文測試.wav

# 播放所有測試結果
afplay temp/test_output_*.wav

# 或在文件管理器中打開
open temp/
```

---

## 🔧 進階使用

### 使用特定視頻片段

如果您想使用視頻的特定片段作為參考：

```python
# 創建自定義參考音頻腳本
from pydub import AudioSegment

# 讀取視頻
audio = AudioSegment.from_file("class3.mp4")

# 選擇特定片段（例如 5-15 秒）
start_ms = 5 * 1000
end_ms = 15 * 1000
ref_chunk = audio[start_ms:end_ms]

# 導出
ref_chunk = ref_chunk.set_frame_rate(24000)
ref_chunk.export("custom_ref.wav", format="wav")

# 然後在測試時使用這個音頻
```

### 測試不同風格

嘗試視頻中不同說話人或不同情緒的片段：

```bash
# 提取不同片段
ffmpeg -i class3.mp4 -ss 00:00:00 -t 00:00:10 -vn calm_voice.wav
ffmpeg -i class3.mp4 -ss 00:01:00 -t 00:00:10 -vn excited_voice.wav

# 分別測試
python test_f5tts_standalone.py --text "平靜的語音測試"
python test_f5tts_standalone.py --text "興奮的語音測試"
```

---

## 💡 優化建議

### 提升克隆質量

1. **參考音頻質量**
   - ✅ 選擇清晰、無背景噪音的片段
   - ✅ 單人說話（避免多人對話）
   - ✅ 音量適中

2. **參考文字準確性**
   - ✅ 使用準確的轉錄文字
   - ✅ 包含標點符號
   - ✅ 與音頻完全對應

3. **生成文字**
   - ✅ 使用相似的語氣和風格
   - ✅ 避免過長的句子
   - ✅ 適當的標點和停頓

### 參考音頻長度建議

| 長度 | 效果 | 適用場景 |
|------|------|---------|
| 3-5 秒 | 基本 | 快速測試 |
| 5-10 秒 | 良好 | 一般使用 ✅ |
| 10-15 秒 | 最佳 | 高質量克隆 |
| > 15 秒 | 過長 | 可能影響性能 |

---

## 🐛 常見問題

### Q: 找不到 class3.mp4？

**A**: 確認文件位置
```bash
ls -lh class3.mp4
# 應該在專案根目錄，與 test_f5tts_standalone.py 同一層
```

### Q: 音頻提取失敗？

**A**: 檢查視頻格式和編碼
```bash
# 查看視頻信息
ffmpeg -i class3.mp4

# 如果格式不支援，轉換一下
ffmpeg -i class3.mp4 -c:v libx264 -c:a aac class3_converted.mp4
```

### Q: 克隆效果不理想？

**A**: 
1. **確保提供了準確的 ref_text**
2. 選擇清晰的音頻片段
3. 嘗試不同的視頻片段
4. 檢查生成文字是否與原聲風格匹配

### Q: 想使用視頻中不同的片段？

**A**: 可以提取多個片段進行測試
```bash
# 提取 5-15 秒的片段
ffmpeg -i class3.mp4 -ss 5 -t 10 -vn ref_5_15.wav

# 手動指定使用這個音頻
# 修改腳本中的 video_path 變量
```

---

## 📚 相關文檔

- [F5-TTS 測試指南](./F5TTS_測試指南.md) - 完整測試說明
- [F5-TTS 安裝總結](./F5TTS_安裝總結.md) - 依賴安裝
- [專案 README](./README.md) - 專案概覽

---

## 🎉 開始測試！

現在您已經準備好了，只需運行：

```bash
python test_f5tts_standalone.py --quick
```

系統會自動：
1. ✅ 檢測到 class3.mp4
2. ✅ 提取音頻
3. ✅ 進行語音克隆測試
4. ✅ 生成測試音頻

**享受高質量的語音克隆效果！** 🎤✨

---

*提示: 如果效果特別好，記得保存這個參考音頻，以後可以直接使用！*

